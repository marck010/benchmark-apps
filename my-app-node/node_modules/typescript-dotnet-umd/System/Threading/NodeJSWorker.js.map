{"version":3,"sources":["System/Threading/NodeJSWorker.js","System/Threading/NodeJSWorker.ts"],"names":["factory","module","exports","v","require","undefined","define","amd","Object","defineProperty","value","ObservableBase_1","extends_1","__extends","ps","NodeJSWorker","_super","url","_this","call","this","process","_process","fork","on","msg","_onNext","JSON","parse","err","_onError","prototype","data","onmessage","error","onerror","_onDispose","removeAllListeners","kill","postMessage","obj","throwIfDisposed","send","stringify","terminate","dispose","ObservableBase"],"mappings":"CAAA,SAAWA,GACP,GAAsB,gBAAXC,SAAiD,gBAAnBA,QAAOC,QAAsB,CAClE,GAAIC,GAAIH,EAAQI,QAASF,QACfG,UAANF,IAAiBF,OAAOC,QAAUC,OAEf,kBAAXG,SAAyBA,OAAOC,KAC5CD,QAAQ,UAAW,UAAW,+BAAgC,iBAAkBN,IAErF,SAAUI,EAASF,GAClB,YACAM,QAAOC,eAAeP,EAAS,cAAgBQ,OAAO,GCH1D,IAAAC,GAAAP,EAAA,gCACAQ,EAAAR,EAAA,iBAEMS,EAAYD,EAAAA,WAEZE,EAAKV,EAAQ,iBAMnBW,EAAA,SAAAC,GAMC,QAAAD,GAAYE,GAAZ,GAAAC,GAECF,EAAAG,KAAAC,OAAOA,KACDC,EAAUH,EAAKI,SAAWR,EAAGS,KAAKN,EDA9B,OCCVI,GAAQG,GAAG,UAAW,SAACC,GAAa,MAAAP,GAAKQ,QAAQC,KAAKC,MAAMH,MAC5DJ,EAAQG,GAAG,QAAS,SAACK,GAAU,MAAAX,GAAKY,SAASD,KDF5BX,ECuCnB,MAhDkCL,GAAAE,EAAAC,GAcvBD,EAAAgB,UAAAL,QAAV,SAAkBM,GAEjBhB,EAAAe,UAAML,QAAOP,KAAAC,KAACY,GACXZ,KAAKa,WACPb,KAAKa,WAAWD,KAAMA,KAIdjB,EAAAgB,UAAAD,SAAV,SAAmBI,GAElBlB,EAAAe,UAAMD,SAAQX,KAAAC,KAACc,GACZd,KAAKe,SACPf,KAAKe,QAAQD,IAGLnB,EAAAgB,UAAAK,WAAV,WAECpB,EAAAe,UAAMK,WAAUjB,KAAAC,MAChBA,KAAKE,SAASe,qBACdjB,KAAKE,SAASgB,OACdlB,KAAKE,SAAW,MAGjBP,EAAAgB,UAAAQ,YAAA,SAAYC,GAEXpB,KAAKqB,kBACLrB,KAAKE,SAASoB,KAAKf,KAAKgB,WAAWX,KAAMQ,MAG1CzB,EAAAgB,UAAAa,UAAA,WAECxB,KAAKyB,WAGP9B,GAhDkCJ,EAAAmC,eAArB5C,GAAAa,aAAAA,EAkDbb,EAAAA,WAAea","file":"NodeJSWorker.js","sourcesContent":["(function (factory) {\n    if (typeof module === \"object\" && typeof module.exports === \"object\") {\n        var v = factory(require, exports);\n        if (v !== undefined) module.exports = v;\n    }\n    else if (typeof define === \"function\" && define.amd) {\n        define([\"require\", \"exports\", \"../Observable/ObservableBase\", \"../../extends\"], factory);\n    }\n})(function (require, exports) {\n    \"use strict\";\n    Object.defineProperty(exports, \"__esModule\", { value: true });\n    var ObservableBase_1 = require(\"../Observable/ObservableBase\");\n    var extends_1 = require(\"../../extends\");\n    // noinspection JSUnusedLocalSymbols\n    var __extends = extends_1.default;\n    var ps = require(\"child_process\");\n    //import {ChildProcess} from \"child_process\";\n    /**\n     * This class takes the place of a WebWorker\n     */\n    var NodeJSWorker = /** @class */ (function (_super) {\n        __extends(NodeJSWorker, _super);\n        function NodeJSWorker(url) {\n            var _this = _super.call(this) || this;\n            var process = _this._process = ps.fork(url);\n            process.on('message', function (msg) { return _this._onNext(JSON.parse(msg)); });\n            process.on('error', function (err) { return _this._onError(err); });\n            return _this;\n        }\n        NodeJSWorker.prototype._onNext = function (data) {\n            _super.prototype._onNext.call(this, data);\n            if (this.onmessage)\n                this.onmessage({ data: data });\n        };\n        NodeJSWorker.prototype._onError = function (error) {\n            _super.prototype._onError.call(this, error);\n            if (this.onerror)\n                this.onerror(error);\n        };\n        NodeJSWorker.prototype._onDispose = function () {\n            _super.prototype._onDispose.call(this);\n            this._process.removeAllListeners(); // just to satisfy paranoia.\n            this._process.kill();\n            this._process = null;\n        };\n        NodeJSWorker.prototype.postMessage = function (obj) {\n            this.throwIfDisposed();\n            this._process.send(JSON.stringify({ data: obj }));\n        };\n        NodeJSWorker.prototype.terminate = function () {\n            this.dispose();\n        };\n        return NodeJSWorker;\n    }(ObservableBase_1.ObservableBase));\n    exports.NodeJSWorker = NodeJSWorker;\n    exports.default = NodeJSWorker;\n});\n","/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n * Based upon Parallel.js: https://github.com/adambom/parallel.js/blob/master/lib/Worker.js\r\n */\r\n///<reference types=\"node\"/>\r\nimport {WorkerLike} from \"./WorkerType\";\r\nimport {ObservableBase} from \"../Observable/ObservableBase\";\r\nimport __extendsImport from \"../../extends\";\r\n// noinspection JSUnusedLocalSymbols\r\nconst __extends = __extendsImport;\r\n\r\nconst ps = require(\"child_process\");\r\n//import {ChildProcess} from \"child_process\";\r\n\r\n/**\r\n * This class takes the place of a WebWorker\r\n */\r\nexport class NodeJSWorker extends ObservableBase<any> implements WorkerLike\r\n{\r\n\tprivate _process:any;\r\n\tonmessage:(message:{data:any})=>void;\r\n\tonerror:(error:any)=>void;\r\n\r\n\tconstructor(url:string)\r\n\t{\r\n\t\tsuper();\r\n\t\tconst process = this._process = ps.fork(url);\r\n\t\tprocess.on('message', (msg:string)=>this._onNext(JSON.parse(msg)));\r\n\t\tprocess.on('error', (err:any)=>this._onError(err));\r\n\t}\r\n\r\n\tprotected _onNext(data:any):void\r\n\t{\r\n\t\tsuper._onNext(data);\r\n\t\tif(this.onmessage)\r\n\t\t\tthis.onmessage({data: data});\r\n\r\n\t}\r\n\r\n\tprotected _onError(error:any):void\r\n\t{\r\n\t\tsuper._onError(error);\r\n\t\tif(this.onerror)\r\n\t\t\tthis.onerror(error);\r\n\t}\r\n\r\n\tprotected _onDispose()\r\n\t{\r\n\t\tsuper._onDispose();\r\n\t\tthis._process.removeAllListeners(); // just to satisfy paranoia.\r\n\t\tthis._process.kill();\r\n\t\tthis._process = null;\r\n\t}\r\n\r\n\tpostMessage(obj:any):void\r\n\t{\r\n\t\tthis.throwIfDisposed();\r\n\t\tthis._process.send(JSON.stringify({data: obj}));\r\n\t}\r\n\r\n\tterminate()\r\n\t{\r\n\t\tthis.dispose();\r\n\t}\r\n\r\n}\r\n\r\nexport default NodeJSWorker;\r\n"]}